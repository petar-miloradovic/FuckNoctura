if(window.nocturaNicknameCache=window.nocturaNicknameCache||{value:null,timestamp:0,cacheExpireMs:3e4},window.processedVoteMessages=window.processedVoteMessages||new Set,window.TIMER_UI_HIDDEN=window.TIMER_UI_HIDDEN||!1,"undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local)try{chrome.storage.local.get(["noctura_timerUIHidden"],items=>{items&&!0===items.noctura_timerUIHidden&&(TIMER_UI_HIDDEN=!0,console.log("[Noctura] Content script: timer UI hidden flag = true (initialized)"))}),chrome.storage.onChanged.addListener((changes,area)=>{"local"===area&&changes.noctura_timerUIHidden&&(TIMER_UI_HIDDEN=!!changes.noctura_timerUIHidden.newValue,console.log("[Noctura] Content script: timer UI hidden flag changed ->",TIMER_UI_HIDDEN))})}catch(e){console.log("[Noctura] chrome.storage not available to initialize timer UI flag",e)}function removeSymbolsFromNickname(nickname){if(!nickname)return"";let cleanName=String(nickname).trim();return cleanName.includes("|")?(cleanName=cleanName.split("|").pop().trim(),console.log(`[Noctura] Cleaned nickname from "${nickname}" â†’ "${cleanName}"`)):console.log(`[Noctura] Normalizing nickname without separator: "${nickname}"`),cleanName=cleanName.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_.-]/g,"").trim(),cleanName||console.warn(`[Noctura] Sanitization removed every character from "${nickname}"`),cleanName}function extractCurrentWolvesvilleNickname(){try{const now=Date.now();if(window.nocturaNicknameCache.value&&now-window.nocturaNicknameCache.timestamp<window.nocturaNicknameCache.cacheExpireMs)return console.log("[Noctura] Using cached nickname:",window.nocturaNicknameCache.value),window.nocturaNicknameCache.value;console.log("[Noctura] Starting OPTIMIZED nickname extraction from Wolvesville...");const commonUIStringsLower=new Set(["Menu","Home","Play","Settings","Profile","Friends","Start","Stop","Continue","Back","Next","Previous","Yes","No","OK","Cancel","Login","Register","Loading","Game","Lobby","Chat","Vote","Day","Night","Voting","Werewolf","Villager","Role","Team","Dead","Alive","Join","Leave","Ready","Waiting","Players","Required","Store","Shop","Market","Collection","News","Updates","Inventory","Inbox","Notifications","Achievements","Quests","Wolvesville","Noctura","Season","Leaderboard","Ranked"].map(value=>value.toLowerCase())),isCommonUIString=candidate=>"string"==typeof candidate&&commonUIStringsLower.has(candidate.toLowerCase()),isLikelyNickname=candidate=>{if(!candidate)return!1;const length=candidate.length;return!(length<2||length>20)&&(!/^\d+$/.test(candidate)&&(!/^[_-]+$/.test(candidate)&&!!/[a-zA-Z]/.test(candidate)))};console.log("[Noctura] Method 0 (PRIORITY): Looking in header top-right...");const headerDivs=document.querySelectorAll('div[dir="auto"]');for(const div of headerDivs){const text=div.textContent?.trim();if(text&&text.includes("|")){const rect=div.getBoundingClientRect();if(rect.top<200&&rect.left>.5*window.innerWidth){const parts=text.split("|");if(parts.length>=2){const potentialNick=parts[parts.length-1].trim();if(potentialNick&&potentialNick.length>=2&&potentialNick.length<=30&&/^[a-zA-Z0-9_-]+$/.test(potentialNick)&&!isCommonUIString(potentialNick)){const cleanNickname=removeSymbolsFromNickname(text);if(isLikelyNickname(cleanNickname))return console.log("[Noctura] âœ… FOUND in header top-right:",text),console.log("[Noctura] Position:",`top=${rect.top}px, left=${rect.left}px`),console.log("[Noctura] Clean nickname:",cleanNickname),window.nocturaNicknameCache.value=cleanNickname,window.nocturaNicknameCache.timestamp=Date.now(),cleanNickname}}}}}console.log("[Noctura] âš ï¸ Header top-right method failed, trying other methods..."),console.log("[Noctura] Method 1 OPTIMIZED: Looking for pipe-separated nicknames...");const specificSelectors=['div[class*="player"]','span[class*="player"]','div[class*="name"]','span[class*="name"]',".username",".nickname",'[data-testid*="name"]'];for(const selector of specificSelectors)try{const elements=document.querySelectorAll(selector);for(const element of elements){const text=element.textContent?.trim();if(text&&text.includes("|")){const parts=text.split("|");if(parts.length>=2){const potentialNick=parts[parts.length-1].trim();if(potentialNick&&potentialNick.length>=2&&potentialNick.length<=30&&/^[a-zA-Z0-9_-]+$/.test(potentialNick)&&!isCommonUIString(potentialNick)){const cleanNickname=removeSymbolsFromNickname(text);if(isLikelyNickname(cleanNickname)&&!isCommonUIString(cleanNickname))return console.log("[Noctura] QUICK FIND - Found pipe-separated nickname:",text),console.log("[Noctura] Clean nickname after symbol processing:",cleanNickname),window.nocturaNicknameCache.value=cleanNickname,window.nocturaNicknameCache.timestamp=Date.now(),cleanNickname}}}}}catch(e){console.log("[Noctura] Skipped invalid selector:",selector)}console.log("[Noctura] Fallback: Using limited DOM query...");const limitedElements=document.querySelectorAll("div, span, p, a");for(const element of limitedElements){const text=element.textContent?.trim();if(text&&text.includes("|")){const parts=text.split("|");if(parts.length>=2){const potentialNick=parts[parts.length-1].trim();if(potentialNick&&potentialNick.length>=2&&potentialNick.length<=30&&/^[a-zA-Z0-9_-]+$/.test(potentialNick)&&!isCommonUIString(potentialNick)){const cleanNickname=removeSymbolsFromNickname(text);if(isLikelyNickname(cleanNickname)&&!isCommonUIString(cleanNickname))return console.log("[Noctura] Fallback - Found pipe-separated nickname:",text),console.log("[Noctura] Clean nickname after symbol processing:",cleanNickname),window.nocturaNicknameCache.value=cleanNickname,window.nocturaNicknameCache.timestamp=Date.now(),cleanNickname}}}}console.log("[Noctura] Method 2: Looking for current player indicators...");const playerIndicatorSelectors=['*[class*="current"]','*[class*="active"]','*[class*="self"]','*[class*="me"]','*[class*="you"]','*[class*="selected"]','*[data-current="true"]','*[data-active="true"]'];for(const selector of playerIndicatorSelectors)try{const elements=document.querySelectorAll(selector);for(const element of elements){const text=element.textContent?.trim();if(text&&text.length>=2&&text.length<=30){let potentialNick=text;if(text.includes("|")&&(potentialNick=text.split("|").pop().trim()),potentialNick&&/^[a-zA-Z0-9_-]+$/.test(potentialNick)&&!isCommonUIString(potentialNick)){console.log("[Noctura] Found nickname in current player element (raw):",text);const cleanNickname=removeSymbolsFromNickname(text);if(isLikelyNickname(cleanNickname)&&!isCommonUIString(cleanNickname))return console.log("[Noctura] Clean nickname after symbol processing:",cleanNickname),cleanNickname}}}}catch(e){console.log("[Noctura] Skipped invalid selector:",selector)}console.log("[Noctura] Method 3: Looking in player lists...");const playerListElements=document.querySelectorAll('div[class*="player"], div[class*="participants"] span, .game-players span, div[class*="Player"], span[class*="Player"]');for(const element of playerListElements){const text=element.textContent?.trim();if(text&&text.length>=2&&text.length<=30&&!text.includes("Role:")&&!text.includes("Dead")&&!text.includes("Alive")){let potentialNick=text;if(text.includes("|")&&(potentialNick=text.split("|").pop().trim()),potentialNick&&potentialNick.length>=2&&potentialNick.length<=30&&/^[a-zA-Z0-9_-]+$/.test(potentialNick)&&!isCommonUIString(potentialNick)){const parent=element.closest("div");if(parent&&(parent.classList.toString().includes("selected")||parent.classList.toString().includes("current")||parent.classList.toString().includes("active")||parent.classList.toString().includes("me"))){console.log("[Noctura] ðŸ” Found my nickname in player list (raw):",text);const cleanNickname=removeSymbolsFromNickname(text);if(isLikelyNickname(cleanNickname)&&!isCommonUIString(cleanNickname))return console.log("[Noctura] ðŸ” Clean nickname after symbol processing:",cleanNickname),cleanNickname}}}}console.log("[Noctura] Method 4: Trying Wolvesville-specific selectors...");const wolvesvilleSelectors=['div[class*="name"]','span[class*="player"]','div[class*="user"]',".player-name",".username",".nickname",'[data-testid*="player"]','[data-testid*="name"]','*[class*="Player"]','*[class*="NAME"]','*[class*="Nick"]'];for(const selector of wolvesvilleSelectors)try{const elements=document.querySelectorAll(selector);for(const element of elements){const text=element.textContent?.trim();if(!text)continue;let potentialNick=text;if(text.includes("|")&&(potentialNick=text.split("|").pop().trim()),potentialNick&&potentialNick.length>=2&&potentialNick.length<=30&&/^[a-zA-Z0-9_-]+$/.test(potentialNick)&&!isCommonUIString(potentialNick)){const parent=element.closest("div, section, article"),parentText=parent?parent.textContent.toLowerCase():"";if(parentText.includes("you")||parentText.includes("current")||parentText.includes("player")||element.classList.toString().includes("current")||element.classList.toString().includes("active")||element.classList.toString().includes("self")){console.log("[Noctura] Found nickname in Wolvesville-specific element (raw):",text);const cleanNickname=removeSymbolsFromNickname(text);if(isLikelyNickname(cleanNickname)&&!isCommonUIString(cleanNickname))return console.log("[Noctura] Clean nickname after symbol processing:",cleanNickname),cleanNickname}}}}catch(e){console.log("[Noctura] Skipped invalid selector:",selector)}console.log("[Noctura] Method 5: Looking in menu/header elements...");const menuElements=document.querySelectorAll("header *, nav *, .header *, .menu *, .user-info *");for(const element of menuElements){const text=element.textContent?.trim();if(text&&text.length>=2&&text.length<=30){let potentialNick=text;if(text.includes("|")&&(potentialNick=text.split("|").pop().trim()),potentialNick&&!potentialNick.includes("Menu")&&!potentialNick.includes("Settings")&&!potentialNick.includes("Home")&&!potentialNick.includes("Play")&&!potentialNick.includes("Profile")&&!potentialNick.includes("Friends")&&/^[a-zA-Z0-9_-]+$/.test(potentialNick)&&!isCommonUIString(potentialNick)){const parentText=element.parentElement?.textContent||"";if(parentText.toLowerCase().includes("welcome")||parentText.toLowerCase().includes("hello")||element.className.includes("user")||element.className.includes("profile")){console.log("[Noctura] Found potential nickname in menu (raw):",text);const cleanNickname=removeSymbolsFromNickname(text);if(isLikelyNickname(cleanNickname)&&!isCommonUIString(cleanNickname))return console.log("[Noctura] Clean nickname after symbol processing:",cleanNickname),cleanNickname}}}}console.log("[Noctura] Method 6: Checking URL for nickname...");const url=window.location.href,patterns=[/\/profile\/([^\/?&]+)/,/\/player\/([^\/?&]+)/,/\/user\/([^\/?&]+)/,/username=([^&]+)/,/player=([^&]+)/,/nick=([^&]+)/,/name=([^&]+)/];for(const pattern of patterns){const match=url.match(pattern);if(match&&match[1]){let nickname=decodeURIComponent(match[1]);if(nickname.includes("|")&&(nickname=nickname.split("|").pop().trim()),nickname&&/^[a-zA-Z0-9_.-]+$/.test(nickname)&&!isCommonUIString(nickname)){console.log("[Noctura] Found nickname in URL (raw):",match[1]);const cleanNickname=removeSymbolsFromNickname(match[1]);if(isLikelyNickname(cleanNickname)&&!isCommonUIString(cleanNickname))return console.log("[Noctura] Clean nickname after symbol processing:",cleanNickname),cleanNickname}}}console.log("[Noctura] Method 7: Checking game data objects...");try{if(window.gameData&&window.gameData.currentPlayer){const nickname=window.gameData.currentPlayer.name||window.gameData.currentPlayer.nickname;if(nickname&&!isCommonUIString(nickname)){console.log("[Noctura] Found nickname in gameData (raw):",nickname);const cleanNickname=removeSymbolsFromNickname(nickname);if(isLikelyNickname(cleanNickname)&&!isCommonUIString(cleanNickname))return console.log("[Noctura] Clean nickname after symbol processing:",cleanNickname),cleanNickname}}if(window.playerData){const nickname=window.playerData.name||window.playerData.nickname||window.playerData.username;if(nickname&&!isCommonUIString(nickname)){console.log("[Noctura] Found nickname in playerData (raw):",nickname);const cleanNickname=removeSymbolsFromNickname(nickname);if(isLikelyNickname(cleanNickname)&&!isCommonUIString(cleanNickname))return console.log("[Noctura] Clean nickname after symbol processing:",cleanNickname),cleanNickname}}}catch(e){console.log("[Noctura] No game data objects found")}console.log("[Noctura] Method 8 OPTIMIZED: Enhanced fallback method...");const potentialNicknames=[];for(const element of limitedElements){const text=element.textContent?.trim();if(!text)continue;let candidates=[text];text.includes("|")&&candidates.push(text.split("|").pop().trim());for(const candidate of candidates)if(candidate&&candidate.length>=2&&candidate.length<=30&&!candidate.includes(" ")&&!candidate.includes("\n")&&!candidate.includes("\t")&&/^[a-zA-Z0-9_.-]+$/.test(candidate)&&!isCommonUIString(candidate)&&!candidate.match(/^\d+$/)&&!candidate.match(/^[_\.-]+$/)&&candidate.match(/[a-zA-Z]/)){const escapedCandidate=candidate.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),regex=new RegExp(`\\b${escapedCandidate}\\b`,"g"),matches=document.body?.textContent?.match(regex),count=matches?matches.length:0;if(count>=1&&count<=15){let contextScore=0;const allTextContent=document.body?.textContent?.toLowerCase()||"";(allTextContent.includes(candidate.toLowerCase()+" is")||allTextContent.includes("player "+candidate.toLowerCase())||allTextContent.includes(candidate.toLowerCase()+" voted")||allTextContent.includes("welcome "+candidate.toLowerCase())||allTextContent.includes(candidate.toLowerCase()+" joined")||allTextContent.includes("you are "+candidate.toLowerCase()))&&(contextScore+=5),text.includes("|")&&text.includes(candidate)&&(contextScore+=3),potentialNicknames.push({text:candidate,originalText:text,count:count,contextScore:contextScore,totalScore:count+contextScore})}}}if(potentialNicknames.length>0){potentialNicknames.sort((a,b)=>b.totalScore-a.totalScore),console.log("[Noctura] All potential nicknames found (top 5):",potentialNicknames.slice(0,5));const mostLikely=potentialNicknames[0];console.log("[Noctura] Best candidate nickname (raw):",mostLikely.originalText,`(appears ${mostLikely.count} times, context score: ${mostLikely.contextScore})`);const cleanNickname=removeSymbolsFromNickname(mostLikely.originalText);return console.log("[Noctura] Final clean nickname:",cleanNickname),cleanNickname}return console.warn("[Noctura] Could not extract nickname from Wolvesville using any method"),null}catch(error){return console.error("[Noctura] Error extracting nickname:",error),null}}function verifyNicknameMatch(botNickname,siteNickname){if(!botNickname||!siteNickname)return console.warn("[Noctura] Missing nickname data for verification"),console.warn("[Noctura] Bot nickname:",botNickname),console.warn("[Noctura] Site nickname:",siteNickname),!1;const cleanBotName=removeSymbolsFromNickname(botNickname),cleanSiteName=removeSymbolsFromNickname(siteNickname),normalizedBotName=cleanBotName.toLowerCase().trim(),normalizedSiteName=cleanSiteName.toLowerCase().trim(),isMatch=normalizedBotName===normalizedSiteName;return console.log("[Noctura] Nickname Verification (Enhanced):"),console.log("[Noctura] Bot configured for:",botNickname,"â†’ cleaned:",cleanBotName),console.log("[Noctura] Current Wolvesville user:",siteNickname,"â†’ cleaned:",cleanSiteName),console.log("[Noctura] Normalized comparison:",normalizedBotName,"===",normalizedSiteName),console.log("[Noctura] Match result:",isMatch?"VERIFIED":"MISMATCH"),isMatch||(console.log("[Noctura] Debug info:"),console.log("[Noctura] - Bot name length:",normalizedBotName.length),console.log("[Noctura] - Site name length:",normalizedSiteName.length),console.log("[Noctura] - Character difference:",Array.from(normalizedBotName).map((char,i)=>char===normalizedSiteName[i]?"âœ“":`X(${char} vs ${normalizedSiteName[i]||"END"})`))),isMatch}function displaySecurityAlert(botNickname,siteNickname){const overlay=document.createElement("div");overlay.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(139, 0, 0, 0.95);\n    color: white;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n    font-family: Arial, sans-serif;\n    font-size: 18px;\n  ",overlay.innerHTML=`\n    <div style="text-align: center; padding: 40px; background: #8B0000; border: 3px solid #FF4444; border-radius: 15px; max-width: 600px;">\n      <h2 style="color: #FFD700; margin-bottom: 20px;">ðŸš« SECURITY: ACCESS DENIED</h2>\n      <p style="margin-bottom: 15px;"><strong>The bot has been blocked for security reasons.</strong></p>\n      <p style="margin-bottom: 10px;">Bot configured for: <strong>${botNickname}</strong></p>\n      <p style="margin-bottom: 15px;">Detected Wolvesville user: <strong>${siteNickname||"Not detected"}</strong></p>\n      <p style="font-size: 12px; color: #FFAAAA; margin-bottom: 20px;">(Symbol prefixes like 'âšš|' are automatically excluded from comparison)</p>\n      <p style="font-size: 14px; color: #FFAAAA;">The bot can only be used by the authorized owner.</p>\n      <button onclick="this.parentElement.parentElement.remove()" \n              style="margin-top: 20px; padding: 10px 20px; background: #444; color: white; border: none; cursor: pointer; border-radius: 5px;">\n        Close this warning\n      </button>\n    </div>\n  `,document.body.appendChild(overlay),setTimeout(()=>{overlay.parentElement&&overlay.remove()},3e4)}function click(_0x49d189,_0x44154c="left"){const _0x2acab0=_0x49d189.getBoundingClientRect(),_0x55512a=_0x2acab0.left+_0x2acab0.width/2,_0x4bb074=_0x2acab0.top+_0x2acab0.height/2;console.log("[Noctura] Request click @",_0x55512a,_0x4bb074,"â†’",_0x49d189.textContent.trim());try{chrome.runtime.sendMessage({action:"performClick",x:_0x55512a,y:_0x4bb074,button:_0x44154c},_0xb332e4=>{chrome.runtime.lastError?console.error("[Noctura] sendMessage error:",chrome.runtime.lastError.message):console.log("[Noctura] BG responded:",_0xb332e4)})}catch(e){try{console.warn("[Noctura] performClick failed, falling back to DOM dispatchEvent click",e&&e.message);const evt=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});_0x49d189.dispatchEvent(evt);try{_0x49d189.focus&&_0x49d189.focus(),document.activeElement!==_0x49d189&&(_0x49d189.tabIndex=-1)}catch(ignore){}}catch(e2){console.error("[Noctura] DOM fallback click failed:",e2&&e2.message)}}}function isVisible(_0x4567bd){const _0x22409e=window.getComputedStyle(_0x4567bd);return null!==_0x4567bd.offsetParent&&_0x4567bd.offsetWidth>0&&_0x4567bd.offsetHeight>0&&"hidden"!==_0x22409e.visibility&&"none"!==_0x22409e.display&&_0x4567bd.getClientRects().length>0}function waitForTextInDOM(_0x94bd78,{timeout:timeout=3e4,interval:interval=200,cancelText:cancelText=null}={}){return TIMER_UI_HIDDEN?(console.log("[Noctura] waitForTextInDOM: skipped due to timer UI hidden flag"),Promise.resolve(null)):waitForCondition(()=>{for(const _0x54205b of document.body.querySelectorAll("*"))if(_0x54205b.textContent.includes(_0x94bd78)&&isVisible(_0x54205b))return _0x54205b},timeout,interval,cancelText)}function waitForExactText(_0x3b6798,{timeout:timeout=3e4,interval:interval=200,cancelText:cancelText=null}={}){const _0x42ed4b=new RegExp("\\b"+_0x3b6798+"\\b");return TIMER_UI_HIDDEN?(console.log("[Noctura] waitForExactText: skipped due to timer UI hidden flag"),Promise.resolve(null)):waitForCondition(()=>{for(const _0x2705cd of document.body.querySelectorAll("*"))if(_0x42ed4b.test(_0x2705cd.textContent)&&isVisible(_0x2705cd))return _0x2705cd},timeout,interval,cancelText)}function waitForImageInDOM(_0x1600f1,{timeout:timeout=3e4,interval:interval=200,cancelText:cancelText=null}={}){return TIMER_UI_HIDDEN?(console.log("[Noctura] waitForImageInDOM: skipped due to timer UI hidden flag"),Promise.resolve(null)):waitForCondition(()=>{for(const _0x2c135a of document.images)if(_0x2c135a.src.includes(_0x1600f1)&&isVisible(_0x2c135a))return _0x2c135a},timeout,interval,cancelText)}function waitForImageCountInDOM(_0x5d5498,_0xe170bb=2,{timeout:timeout=3e4,interval:interval=200,cancelText:cancelText=null}={}){return TIMER_UI_HIDDEN?(console.log("[Noctura] waitForImageCountInDOM: skipped due to timer UI hidden flag"),Promise.resolve(null)):waitForCondition(()=>{const _0x2ae9df=[];for(const _0x49bba9 of document.images)if(_0x49bba9.src.includes(_0x5d5498)&&isVisible(_0x49bba9)&&_0x2ae9df.push(_0x49bba9),_0x2ae9df.length>=_0xe170bb)return _0x2ae9df},timeout,interval,cancelText)}function waitForCondition(_0x4da2fc,_0x3fb8e6,_0x226806,_0x41c744){return new Promise(_0x370104=>{const _0x4d2ec0=Date.now(),_0x3ff3a0=()=>{if(TIMER_UI_HIDDEN)return _0x370104(null);const _0x449711=_0x4da2fc();return _0x449711?_0x370104(_0x449711):_0x41c744&&document.body.innerText.includes(_0x41c744)||Date.now()-_0x4d2ec0>=_0x3fb8e6?_0x370104(null):void setTimeout(_0x3ff3a0,_0x226806)};_0x3ff3a0()})}function sleep(_0x3a6564){return new Promise(_0x256758=>setTimeout(_0x256758,_0x3a6564))}async function clickAndVerifyDisappear(_0x5792e6,_0x5df0f9,_0x506d6f=3){for(let _0x46245c=0;_0x46245c<_0x506d6f;_0x46245c++){const _0x33ab46=_0x5df0f9();if(!_0x33ab46)break;click(_0x33ab46),await sleep(300);if(!Array.from(document.querySelectorAll("*")).some(_0x48cd2f=>_0x48cd2f.textContent.includes(_0x5792e6)&&isVisible(_0x48cd2f)))break}}function clickElementByImage(_0x4ec7c9){const _0x3177b2=Array.from(document.querySelectorAll('[tabindex="0"]')).find(_0x3cb874=>Array.from(_0x3cb874.querySelectorAll("img")).some(_0x316867=>_0x4ec7c9.test(_0x316867.src))&&!_0x3cb874.disabled);_0x3177b2&&click(_0x3177b2)}function clickElementByImageInElement(_0x14aad2,_0x649776){const _0x352bdb=Array.from(_0x14aad2.querySelectorAll("img")).find(_0x2dac61=>_0x649776.test(_0x2dac61.src));if(_0x352bdb){const _0x50fc05=_0x352bdb.closest('[tabindex="0"]');_0x50fc05&&!_0x50fc05.disabled&&click(_0x50fc05)}}function clickElementByText(_0x4cc263){const _0x1690c1=Array.from(document.querySelectorAll('[tabindex="0"]')).find(_0x25e961=>_0x25e961.textContent.includes(_0x4cc263)&&!_0x25e961.disabled);_0x1690c1&&click(_0x1690c1)}function clickInnermostElementByImage(_0x36f23d){const _0x2ab3f8=Array.from(document.querySelectorAll('[tabindex="0"]')).filter(_0x43e84d=>Array.from(_0x43e84d.querySelectorAll("img")).some(_0x3c179d=>_0x3c179d.src.includes(_0x36f23d))&&!_0x43e84d.disabled);if(0===_0x2ab3f8.length)return;let _0x5bd8d4=_0x2ab3f8[0],_0x377940=0;for(const _0x4a5412 of _0x2ab3f8){let _0x3009ea=0,_0x2b9529=_0x4a5412.parentElement;for(;_0x2b9529;)_0x3009ea++,_0x2b9529=_0x2b9529.parentElement;_0x3009ea>_0x377940&&(_0x377940=_0x3009ea,_0x5bd8d4=_0x4a5412)}click(_0x5bd8d4)}function clickInnermostElementByText(_0x57f5a1){const _0x2693f8=Array.from(document.querySelectorAll('[tabindex="0"]')).filter(_0x33738b=>_0x33738b.textContent.includes(_0x57f5a1)&&!_0x33738b.disabled);if(0===_0x2693f8.length)return;let _0x4ff268=_0x2693f8[0],_0x92345f=0;_0x2693f8.forEach(_0x235207=>{let _0x76453b=0,_0x468c4f=_0x235207.parentElement;for(;_0x468c4f;)_0x76453b++,_0x468c4f=_0x468c4f.parentElement;_0x76453b>_0x92345f&&(_0x92345f=_0x76453b,_0x4ff268=_0x235207)}),click(_0x4ff268)}function clickOutermostElement(_0xb08b59){const _0xe1337c=Array.from(_0xb08b59.querySelectorAll('[tabindex="0"]')).filter(_0x2a0c67=>!_0x2a0c67.disabled);if(0===_0xe1337c.length)return;let _0x3f1e11=_0xe1337c[0],_0x2d2cf9=1/0;_0xe1337c.forEach(_0x4eda38=>{let _0x5120f4=0,_0x2ef019=_0x4eda38.parentElement;for(;_0x2ef019&&_0x2ef019!==_0xb08b59;)_0x5120f4++,_0x2ef019=_0x2ef019.parentElement;_0x5120f4<_0x2d2cf9&&(_0x2d2cf9=_0x5120f4,_0x3f1e11=_0x4eda38)}),click(_0x3f1e11)}function findImageInDocument(_0x1909a5){return Array.from(document.querySelectorAll("img")).some(_0x3079bb=>_0x3079bb.src.includes(_0x1909a5))}function findImageInElement(_0x52a8f5,_0x2a9081){return Array.from(_0x52a8f5.querySelectorAll("img")).some(_0x4bc3e5=>_0x2a9081.test(_0x4bc3e5.src))}function findTextInDocument(_0x386754){return document.body.textContent.includes(_0x386754)}function getMessages(){let _0x127537=[],_0x20de7a=1/0;return document.querySelectorAll("span").forEach(_0x4214a1=>{if(_0x4214a1.textContent.includes(":")){let _0x46f339=_0x4214a1.closest("div");if(_0x46f339){let _0x27388b=_0x46f339.getBoundingClientRect().width*_0x46f339.getBoundingClientRect().height;_0x27388b<_0x20de7a?(_0x20de7a=_0x27388b,_0x127537=[{div:_0x46f339,spanText:_0x4214a1.textContent}]):_0x27388b===_0x20de7a&&_0x127537.push({div:_0x46f339,spanText:_0x4214a1.textContent})}}}),_0x127537.length>0?_0x127537.map(({div:_0x55e151,spanText:_0x3c9117})=>{const playerNumberMatch=_0x3c9117.match(/(\d{1,2})/);return{playerNumber:playerNumberMatch?playerNumberMatch[1]:null,text:_0x55e151.textContent.replace(_0x3c9117,"").replace(/^:\s*/,"").trim(),fullText:_0x55e151.textContent.trim()}}):null}function getPlayerRole(_0x5db153){if(!_0x5db153)return"Unknown";console.log("[Noctura] ðŸ” Detecting role from:",_0x5db153);let _0x3d5e22="Other";const _0x102528={juniorwerewolf:"Junior Werewolf",junior_werewolf:"Junior Werewolf",split_wolf:"Split Wolf",splitwolf:"Split Wolf",wolf:"Wolf",priest:"Priest",vigilante:"Shooter",gunner:"Shooter","serial-killer":"Serial Killer","evil-detective":"Evil Detective",evil_detective:"Evil Detective",icon_evil_detective:"Evil Detective",icon_evil_detective_filled:"Evil Detective",arsonist:"Arsonist",corruptor:"Corruptor",bandit:"Bandit",cannibal:"Cannibal",bomber:"Bomber",alchemist:"Alchemist",siren:"Siren",illusionist:"Illusionist",blight:"Blight","sect-leader":"Sect Leader",zombie:"Zombie"};for(const _0x189c38 of Object.keys(_0x102528))if(_0x5db153.includes(_0x189c38)){_0x3d5e22=_0x102528[_0x189c38],console.log("[Noctura] ðŸŽ­ Role detected:",_0x3d5e22,"from pattern:",_0x189c38);break}"Other"===_0x3d5e22&&console.log("[Noctura] âš ï¸ Could not detect role from:",_0x5db153);try{const lowered=String(_0x5db153).toLowerCase();"Other"===_0x3d5e22&&(lowered.includes("detective")||/evil[_-]?detective/.test(lowered)||/evil.*detective/.test(lowered))&&(console.log("[Noctura] getPlayerRole: Loose match -> Evil Detective detected from",_0x5db153),_0x3d5e22="Evil Detective")}catch(e){}return _0x3d5e22}async function shooterAction(_0x5dbf62,_0x3da36c,_0xefcf26,_0x42d1b3=2){console.log("[Noctura] shooterAction: checking for solo messages first");const messages=getMessages();if(messages)for(const msg of messages)if(msg.text&&"Rk here"===msg.text.trim()){const playerNumber=msg.playerNumber;if(playerNumber&&playerNumber!==_0x5dbf62.number){const targetPlayer=_0xefcf26.find(el=>el.textContent.trim().startsWith(playerNumber+" "));if(targetPlayer&&!_0x3da36c.includes(targetPlayer))return console.log("[Noctura] ðŸ”« Shooter found solo target:",playerNumber),clickElementByImage(/.*gunner_bullet.*\.png/),await sleep(200),void clickElementByImageInElement(targetPlayer,/.*gunner_voting_shoot.*\.png/)}}if(console.log("[Noctura] shooterAction: looking for",_0x42d1b3,"vote marker(s)"),_0x42d1b3>4)return;const _0xd78aab=await waitForImageCountInDOM("vote_day_selected",_0x42d1b3,{timeout:9e4,cancelText:"Continue"});if(gameIsOver())return;if(!_0xd78aab)return void console.warn("[Noctura] ðŸ›‘ Shooter/Priest: No vote markers found, NOT using ability");console.log("[Noctura] Clicking bullet icon..."),clickElementByImage(/.*gunner_bullet.*\.png/),await sleep(200);const _0x524327=_0xefcf26.find(_0x1bf01f=>findImageInElement(_0x1bf01f,new RegExp(".*vote_day_selected.*\\.png"))&&!_0x3da36c.includes(_0x1bf01f)&&!_0x1bf01f.textContent.includes(_0x5dbf62.name));if(_0x524327)return console.log("[Noctura] Shooter found target:",_0x524327?.textContent.trim()),void clickElementByImageInElement(_0x524327,/.*gunner_voting_shoot.*\.png/);await sleep(500),await shooterAction(_0x5dbf62,_0x3da36c,_0xefcf26,_0x42d1b3+1)}async function inGameDay(_0x9c2380,_0x251e3b,_0x3217f1,_0x501c32){if(!gameIsOver()){if(console.log("[Noctura] inGameDay(): role =",_0x9c2380.role,"| Lovers =",_0x251e3b.map(_0x3af2d9=>_0x3af2d9?.textContent.trim())),soloSet.has(_0x9c2380.role)){console.log("[Noctura] ðŸŽ­ Solo role detected:",_0x9c2380.role);let textarea=document.querySelector("textarea");Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value").set.call(textarea,"Rk here"),textarea.dispatchEvent(new Event("input",{bubbles:!0})),textarea.dispatchEvent(new Event("change",{bubbles:!0})),clickElementByImage(/.*icon_send.*\.png/);const messages=getMessages();if(messages)for(const msg of messages)if(msg.text&&"Rk here"===msg.text.trim()){const playerNumber=msg.playerNumber;if(playerNumber&&playerNumber!==_0x9c2380.number){const targetPlayer=_0x501c32.find(el=>el.textContent.trim().startsWith(playerNumber+" "));if(targetPlayer){console.log("[Noctura] ðŸŽ¯ Solo role voting target:",playerNumber),clickOutermostElement(targetPlayer);break}}}return}if(wolfSet.has(_0x9c2380.role)&&(!wolfSet.has(_0x9c2380.coupleRole1)||!wolfSet.has(_0x9c2380.coupleRole2))){let _0x252689=getMessages()?.flatMap(_0x52e9cb=>(_0x52e9cb?.fullText||_0x52e9cb).match(/\b\d{1,2}\b/g)||[]);if(_0x252689?.some(_0x23d1f1=>_0x23d1f1==_0x9c2380.number))return void console.log("[Noctura] Wolf number already in chat, skipping");if(gameIsOver())return;console.log("[Noctura] ðŸº Wolf sending number:",_0x9c2380.number);let _0x5ad7aa=document.querySelector("textarea");return Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value").set.call(_0x5ad7aa,_0x9c2380.number),_0x5ad7aa.dispatchEvent(new Event("input",{bubbles:!0})),_0x5ad7aa.dispatchEvent(new Event("change",{bubbles:!0})),clickElementByImage(/.*icon_send.*\.png/),void sleep(1e3)}if(wolfSet.has(_0x9c2380.coupleRole1)||wolfSet.has(_0x9c2380.coupleRole2)){if(!_0x3217f1.some(_0x33054e=>_0x33054e.some(_0x29857f=>_0x29857f.includes("hand-skin")))){let loverNumberToVote=null;if(_0x9c2380.coupleNumber1&&_0x9c2380.coupleNumber1!==_0x9c2380.number?loverNumberToVote=_0x9c2380.coupleNumber1:_0x9c2380.coupleNumber2&&_0x9c2380.coupleNumber2!==_0x9c2380.number&&(loverNumberToVote=_0x9c2380.coupleNumber2),loverNumberToVote){console.log("[Noctura] ðŸ’‘ VOTING LOVER IN COUPLE: Player #"+loverNumberToVote+" (role: "+(_0x9c2380.coupleRole1===loverNumberToVote.toString()?_0x9c2380.coupleRole1:_0x9c2380.coupleRole2)+")");const loverPlayer=_0x501c32.find(_0x5bf5ba=>_0x5bf5ba.textContent.trim().startsWith(loverNumberToVote+" "));loverPlayer?(clickOutermostElement(loverPlayer),console.log("[Noctura] âœ… Successfully voted lover #"+loverNumberToVote)):console.warn("[Noctura] âš ï¸ Could not find lover player element #"+loverNumberToVote)}else console.warn("[Noctura] âš ï¸ Could not determine lover number in couple")}try{if("Shooter"===_0x9c2380.role&&(wolfSet.has(_0x9c2380.coupleRole1)||wolfSet.has(_0x9c2380.coupleRole2))){const recentMsgs=getMessages();if(!(recentMsgs&&recentMsgs.some(m=>m.text&&"vigi cpl"===m.text.trim().toLowerCase()))){console.log('[Noctura] Shooter in couple with wolf â€” sending "vigi cpl"');const _0x5ad7aa=document.querySelector("textarea");Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value").set.call(_0x5ad7aa,"vigi cpl"),_0x5ad7aa.dispatchEvent(new Event("input",{bubbles:!0})),_0x5ad7aa.dispatchEvent(new Event("change",{bubbles:!0})),clickElementByImage(/.*icon_send.*\.png/),await sleep(300)}}}catch(e){console.warn("[Noctura] Failed to send vigi cpl",e&&e.message)}"Priest"===_0x9c2380.role?(console.log("[Noctura] Role ability triggered:",_0x9c2380.role),clickElementByImage(/.*priest_holy_water.*\.png/),setTimeout(()=>{const _0x49b55e=_0x501c32.find(_0x42be59=>findImageInElement(_0x42be59,/.*priest_holy_water.*\.png/));_0x49b55e&&clickElementByImageInElement(_0x49b55e,/.*priest_holy_water.*\.png/)},200)):"Shooter"===_0x9c2380.role&&await shooterAction(_0x9c2380,_0x251e3b,_0x501c32)}else{const messages=getMessages();let voteSuccessful=!1;if(messages&&messages.length>0){for(let i=messages.length-1;i>=0;i--){const msg=messages[i];if(processedVoteMessages.has(msg.fullText))continue;let targetPlayerNumber=null,voteReason="";const cleanedText=msg.text.trim().toLowerCase();if("me"===cleanedText||"m"===cleanedText||"wc"===cleanedText)targetPlayerNumber=msg.playerNumber,voteReason="keyword '"+msg.text+"' from player "+msg.playerNumber,console.log("[Noctura] AutoVote: Matched keyword - cleaned text: '"+cleanedText+"', player: "+msg.playerNumber);else{const voteNumber=parseInt(msg.text);!isNaN(voteNumber)&&voteNumber>=1&&voteNumber<=16&&(targetPlayerNumber=voteNumber.toString(),voteReason="direct number '"+voteNumber+"' from player "+msg.playerNumber)}if(targetPlayerNumber){if(targetPlayerNumber===_0x9c2380.number){console.log("[Noctura] AutoVote: Skipping - cannot vote for self (player "+targetPlayerNumber+")");continue}const targetPlayer=_0x501c32.find(_0x5bf5ba=>_0x5bf5ba.textContent.trim().startsWith(targetPlayerNumber+" "));if(targetPlayer){console.log("[Noctura] AutoVote: "+voteReason+" â†’ voting player "+targetPlayerNumber),clickOutermostElement(targetPlayer),processedVoteMessages.add(msg.fullText),await sleep(500),voteSuccessful=!0;break}}}}if(!voteSuccessful&&!wolfSet.has(_0x9c2380.role)){console.log("[Noctura] AutoVote: No vote from messages, searching for default wolf target...");for(let i=0;i<_0x501c32.length;i++){const playerElement=_0x501c32[i],playerText=playerElement.textContent.trim();if(playerText.startsWith(_0x9c2380.number+" "))continue;const playerImages=playerElement.querySelectorAll("img");let playerRole=null;for(const img of playerImages){const src=img.src;if(-1===src.indexOf("vote_day")&&-1===src.indexOf("vote_werewolves")&&-1===src.indexOf("hand-skin")){playerRole=getPlayerRole(src.slice(src.lastIndexOf("/")+1));break}}if(playerRole&&wolfSet.has(playerRole)){console.log("[Noctura] AutoVote: Voting default wolf target: player "+playerText.split(" ")[0]+" ("+playerRole+")"),clickOutermostElement(playerElement),voteSuccessful=!0;break}}}voteSuccessful||console.log("[Noctura] AutoVote: Could not find a target to vote");const _0x271493={Priest:{triggerRegex:/.*priest_holy_water.*\.png/,actionRegex:/.*priest_holy_water.*\.png/},Shooter:{triggerRegex:/.*gunner_bullet.*\.png/,actionRegex:/.*gunner_voting_shoot.*\.png/}}[_0x9c2380.role];if(_0x271493){if(await waitForImageInDOM("vote_day_selected",{timeout:9e4,cancelText:"Continue"}),gameIsOver())return;console.log("[Noctura] Role ability triggered:",_0x9c2380.role),clickElementByImage(_0x271493.triggerRegex),await sleep(200);const _0x4bd03e=_0x501c32.find(_0x5bf5ba=>findImageInElement(_0x5bf5ba,/.*vote_day_selected.*\.png/));_0x4bd03e&&clickElementByImageInElement(_0x4bd03e,_0x271493.actionRegex)}}}}async function inGameNight(_0x5c3e10,_0x3f975b,_0x5bcbd9){if(gameIsOver())return;if(console.log("[Noctura] inGameNight(): role =",_0x5c3e10.role),"Evil Detective"===_0x5c3e10.role){if(console.log("[Noctura] Evil Detective action triggered"),!isNight())return void console.log("[Noctura] Evil Detective: not night, aborting action");if(await waitForTextInDOM("25s",{cancelText:"Continue"}),gameIsOver()||findTextInDocument("Voting"))return void console.log("[Noctura] Evil Detective: game over or voting detected, aborting");await sleep(200);const loverNumber=_0x5c3e10.coupleNumber1||_0x5c3e10.coupleNumber2;if(console.log("[Noctura] Evil Detective: lover number is",loverNumber),!loverNumber)return console.log("[Noctura] Evil Detective: no lover number found, aborting"),void await waitForTextInDOM("Voting",{cancelText:"Continue"});let loverFound=!1;for(const playerEl of _0x5bcbd9){const playerText=playerEl.textContent.trim(),numMatch=playerText.match(/^(\d{1,2})\b/),playerNum=numMatch?numMatch[1]:null;if(playerNum&&String(playerNum)===String(loverNumber)){console.log("[Noctura] Evil Detective: clicking lover ->",playerText),clickOutermostElement(playerEl),loverFound=!0,await sleep(500);break}}if(!loverFound)return void console.log("[Noctura] Evil Detective: could not find lover player element");console.log("[Noctura] Evil Detective: clicking own number:",_0x5c3e10.number);for(const playerEl of _0x5bcbd9){const playerText=playerEl.textContent.trim(),numMatch=playerText.match(/^(\d{1,2})\b/),playerNum=numMatch?numMatch[1]:null;if(playerNum&&String(playerNum)===String(_0x5c3e10.number)){console.log("[Noctura] Evil Detective: clicking self ->",playerText),clickOutermostElement(playerEl);break}}return void await waitForTextInDOM("Voting",{cancelText:"Continue"})}const _0xd667dc=(_0x4c383a,_0x579d81)=>{if(gameIsOver())return;console.log("[Noctura] sendAction:",_0x4c383a,"| Target:",_0x579d81?.textContent.trim());const _0x585d5b=document.querySelector("textarea");Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value").set.call(_0x585d5b,_0x4c383a),_0x585d5b.dispatchEvent(new Event("input",{bubbles:!0})),_0x585d5b.dispatchEvent(new Event("change",{bubbles:!0})),clickElementByImage(/.*icon_send.*\.png/),_0x579d81&&("Priest"!==_0x5c3e10.coupleRole1&&"Priest"!==_0x5c3e10.coupleRole2||"Junior Werewolf"===_0x5c3e10.role)&&clickOutermostElement(_0x579d81)},_0x525eca=async _0x129089=>{if(wolfSet.has(_0x5c3e10.coupleRole1)&&wolfSet.has(_0x5c3e10.coupleRole2)||wolfSet.has(_0x5c3e10.coupleRole1)&&null===_0x5c3e10.coupleRole2)return;if(gameIsOver())return;if(console.log("[Noctura] handleWolfTag() triggered for:",_0x5c3e10.role),await waitForTextInDOM("25s",{cancelText:"Continue"}),gameIsOver()||findTextInDocument("Voting"))return;const _0x1fc4b9=!wolfSet.has(_0x5c3e10.coupleRole1);_0xd667dc("Who? Mine "+(_0x1fc4b9?_0x5c3e10.coupleNumber1:_0x5c3e10.coupleNumber2),_0x1fc4b9?_0x3f975b[0]:_0x3f975b[1]),await waitForExactText("5s",{cancelText:"Continue"}),gameIsOver()||findTextInDocument("Voting")||(clickElementByImage(_0x129089),setTimeout(()=>{const _0x193dc2=getMessages(),_0x511a75=_0x193dc2?.flatMap(_0x361c1f=>((_0x361c1f.text||_0x361c1f).match(/\b\d{1,2}\b/g)||[]).filter(_0x5280c1=>![_0x5c3e10.number,_0x5c3e10.coupleNumber1,_0x5c3e10.coupleNumber2,_0x361c1f.playerNumber].includes(_0x5280c1)))[0];if(!_0x511a75)return;console.log("[Noctura] Target number chosen:",_0x511a75);const _0x4c6e9d=[..._0x5bcbd9[parseInt(_0x511a75,10)-1].querySelectorAll("img")].find(_0x589b98=>_0x129089.test(_0x589b98.src)),_0xb7afd5=_0x4c6e9d?.closest('[tabindex="0"]:not([disabled])');_0xb7afd5&&click(_0xb7afd5)},200),await waitForTextInDOM("Voting",{cancelText:"Continue"}))};if("Wolf"===_0x5c3e10.role){if(await waitForTextInDOM("25s",{cancelText:"Continue"}),gameIsOver()||findTextInDocument("Voting"))return;const _0x3ee67f=_0x5c3e10.coupleRole1,_0x3d3181=_0x5c3e10.coupleRole2,hasLoverPartner=_0x5c3e10.coupleNumber1||_0x5c3e10.coupleNumber2;if(wolfSet.has(_0x3ee67f)&&wolfSet.has(_0x3d3181)){console.log("[Noctura] ðŸºðŸº WOLF COUPLE (2 wolves): Skipping number write, voting partner directly");const _0x1749e8=_0x5c3e10.coupleNumber1===_0x5c3e10.number?_0x5c3e10.coupleNumber2:_0x5c3e10.coupleNumber1,loverTarget=_0x5bcbd9.find(_0x5bf5ba=>_0x5bf5ba.textContent.trim().startsWith(_0x1749e8+" "));return loverTarget&&(clickOutermostElement(loverTarget),console.log("[Noctura] âœ… Wolf couple voted:",_0x1749e8)),void await waitForTextInDOM("Voting",{cancelText:"Continue"})}if(wolfSet.has(_0x3ee67f)&&null===_0x3d3181&&hasLoverPartner)return void console.log("[Noctura] Wolf voting: skipping standard voting");if(hasLoverPartner){const _0x48aa63="Priest"===_0x3ee67f||"Priest"===_0x3d3181,_0x3bc5bd=!wolfSet.has(_0x5c3e10.coupleRole1),_0x1749e8=_0x3bc5bd?_0x5c3e10.coupleNumber1:_0x5c3e10.coupleNumber2,_0x529252=_0x3bc5bd?_0x3f975b[0]:_0x3f975b[1];if(_0xd667dc(_0x48aa63?_0x1749e8+" priest":_0x1749e8,_0x529252),await waitForExactText("5s",{cancelText:"Continue"}),gameIsOver()||findTextInDocument("Voting"))return;for(let _0x5dba1a=0,_0x3986af=_0x5bcbd9.length;_0x5dba1a<_0x3986af;_0x5dba1a++){const _0x3db97a=_0x5bcbd9[_0x5dba1a].querySelectorAll("img");let _0x1ecec2,_0x3932fa="";for(let _0x18024f=_0x3db97a.length-1;_0x18024f>=0;_0x18024f--)if(_0x1ecec2=_0x3db97a[_0x18024f].src,-1===_0x1ecec2.indexOf("vote_day")&&-1===_0x1ecec2.indexOf("vote_werewolves")&&-1===_0x1ecec2.indexOf("hand-skin")){_0x3932fa=_0x1ecec2.slice(_0x1ecec2.lastIndexOf("/")+1);break}if(_0x3932fa&&"Junior Werewolf"===getPlayerRole(_0x3932fa))for(let _0x34461b=0;_0x34461b<_0x3db97a.length;_0x34461b++)if(-1!==_0x3db97a[_0x34461b].src.indexOf("vote_werewolves_voter")){_0x48aa63||clickOutermostElement(_0x529252);break}}}else{console.log("[Noctura] Wolf voting: no lovers registered (3-player scenario), searching for non-wolf target");for(let i=0;i<_0x5bcbd9.length;i++){const playerElement=_0x5bcbd9[i],playerText=playerElement.textContent.trim();if(playerText.startsWith(_0x5c3e10.number+" "))continue;const playerImages=playerElement.querySelectorAll("img");let playerRole=null;for(const img of playerImages){const src=img.src;if(-1===src.indexOf("vote_day")&&-1===src.indexOf("vote_werewolves")&&-1===src.indexOf("hand-skin")){playerRole=getPlayerRole(src.slice(src.lastIndexOf("/")+1));break}}if(playerRole&&!wolfSet.has(playerRole)){console.log("[Noctura] ðŸº Wolf voting non-wolf player in 3-player scenario: "+playerText.split(" ")[0]+" ("+playerRole+")"),clickOutermostElement(playerElement);break}}}await waitForTextInDOM("Voting",{cancelText:"Continue"})}else"Junior Werewolf"===_0x5c3e10.role?await _0x525eca(/.*junior_werewolf_selection_marker.*\.png/):"Split Wolf"===_0x5c3e10.role&&await _0x525eca(/.*splitwolf_bind.*\.png/)}async function inGame(_0x487724){const _0x2f5eae=Array.from(document.querySelectorAll('[style*="flex-direction: column"]')).filter(_0x385261=>{const _0x51bb17=_0x385261.textContent.trim();return/^\d+\s/.test(_0x51bb17)}),_0x5bd863=_0x2f5eae.filter(_0x5c2869=>Array.from(_0x5c2869.querySelectorAll("img")).some(_0x43fea8=>_0x43fea8.src.includes("cupid_select_lovers_sticker_small")));console.log("[Noctura] AUTO-LOVER SELECTION: Found",_0x5bd863.length,"available lovers"),_0x5bd863.forEach((_0x5c2869,index)=>{console.log(`[Noctura] Lover ${index+1}:`,_0x5c2869.textContent.trim())});let _0x2c32b7=[];_0x5bd863.length>=2?(_0x2c32b7=[_0x5bd863[0],_0x5bd863[1]],console.log("[Noctura] AUTO-SELECTED lovers:"),console.log("[Noctura] Lover 1:",_0x2c32b7[0]?.textContent.trim()),console.log("[Noctura] Lover 2:",_0x2c32b7[1]?.textContent.trim())):1===_0x5bd863.length?(_0x2c32b7=[_0x5bd863[0],null],console.log("[Noctura] Only 1 lover found:",_0x2c32b7[0]?.textContent.trim())):(_0x2c32b7=[null,null],console.log("[Noctura] No lovers found - using null values"));const _0x591321=_0x472934=>_0x472934.map(_0x292847=>Array.from(_0x292847.querySelectorAll("img")).map(_0x213fc5=>{const _0x376733=_0x213fc5.src.split("/");return _0x376733[_0x376733.length-1]})),_0x5d4cc7=_0x591321(_0x2c32b7.filter(lover=>null!==lover)),_0x41d678=_0x591321(_0x5bd863.filter(_0x1b18de=>_0x1b18de.textContent.includes(_0x487724))),_0x53501e=_0x35be62=>_0x35be62.map(_0x4430cd=>{for(var _0x3fff7c=_0x4430cd.length-1;_0x4430cd[_0x3fff7c].includes("vote_day")||_0x4430cd[_0x3fff7c].includes("vote_werewolves")||_0x4430cd[_0x3fff7c].includes("hand-skin");)_0x3fff7c-=1;return _0x4430cd[_0x3fff7c]}),_0x47cd94=_0x53501e(_0x41d678),_0x4507bd=_0x53501e(_0x5d4cc7),_0x15eda2=_0x2f5eae.find(_0x5b14fd=>removeSymbolsFromNickname(_0x5b14fd.textContent).toLowerCase().includes(removeSymbolsFromNickname(_0x487724).toLowerCase())),_0x501d47=_0x2f0ba8=>_0x2f0ba8&&_0x2f0ba8.textContent.match(/\d+/)?_0x2f0ba8.textContent.match(/\d+/)[0]:null,_0x2fc374=_0x2d54d7=>_0x2d54d7?getPlayerRole(_0x2d54d7):null,_0x3b9fec={name:_0x487724,number:_0x501d47(_0x15eda2),role:getPlayerRole(_0x47cd94[0]),coupleNumber1:_0x501d47(_0x2c32b7[0]),coupleRole1:_0x2fc374(_0x4507bd[0]),coupleNumber2:_0x501d47(_0x2c32b7[1]),coupleRole2:_0x2fc374(_0x4507bd[1])};console.log("[Noctura] Player object:",_0x3b9fec);try{const rawPlayerImages=_0x2f5eae.map(el=>Array.from(el.querySelectorAll("img")).map(img=>img.src.split("/").pop()));console.log("[Noctura] All players raw image filenames:",rawPlayerImages),console.log("[Noctura] Current player role-detection inputs:",_0x47cd94,"-> detected role:",_0x3b9fec.role,"playerElementText:",_0x15eda2?.textContent?.trim())}catch(e){console.warn("[Noctura] Failed to collect diagnostic image filenames:",e&&e.message)}console.log("[Noctura] Detected phase:",isDay()?"Day":isNight()?"Night":"Unknown"),isDay()?await inGameDay(_0x3b9fec,_0x2c32b7,_0x41d678,_0x2f5eae):isNight()&&await inGameNight(_0x3b9fec,_0x2c32b7,_0x2f5eae)}async function playAgain(){if(document.body.innerText.includes("Waiting for players"))return;await clickAndVerifyDisappear("Continue",()=>Array.from(document.querySelectorAll('[tabindex="0"]')).find(_0x482233=>_0x482233.textContent.includes("Continue")&&isVisible(_0x482233)&&_0x482233.getBoundingClientRect().top>100)),await waitForTextInDOM("Play again",{cancelText:"INVENTORY"});const _0x56b819=Array.from(document.querySelectorAll('[tabindex="0"]')).find(_0x2821dd=>_0x2821dd.textContent.includes("Play again")&&isVisible(_0x2821dd)&&_0x2821dd.getBoundingClientRect().top>100);_0x56b819&&click(_0x56b819),await sleep(300),await waitForCondition(()=>Array.from(document.querySelectorAll('[tabindex="0"]')).some(_0x5c26cd=>{if(!_0x5c26cd.textContent.includes("OK")||!isVisible(_0x5c26cd)||_0x5c26cd.getBoundingClientRect().top<=100)return!1;return Array.from(_0x5c26cd.parentElement?.querySelectorAll('[tabindex="0"]')||[]).some(_0x199b8a=>_0x199b8a!==_0x5c26cd&&_0x199b8a.textContent.includes("Cancel")&&isVisible(_0x199b8a))}),3e3,200);const _0x400509=Array.from(document.querySelectorAll('[tabindex="0"]')).find(_0x2345ed=>{if(!_0x2345ed.textContent.includes("OK")||!isVisible(_0x2345ed)||_0x2345ed.getBoundingClientRect().top<=100)return!1;return Array.from(_0x2345ed.parentElement?.querySelectorAll('[tabindex="0"]')||[]).some(_0x49911d=>_0x49911d!==_0x2345ed&&_0x49911d.textContent.includes("Cancel")&&isVisible(_0x49911d))});_0x400509&&click(_0x400509),await sleep(300)}function getLabelBeforeTime(){const _0x284258=document.querySelectorAll("div");for(let _0x242ae3=0;_0x242ae3<_0x284258.length;_0x242ae3++){const _0x12a2aa=_0x284258[_0x242ae3].textContent,_0x4a3c10=_0x12a2aa&&_0x12a2aa.match(/^([\S\s]*?)\s*\d{1,2}s$/);if(_0x4a3c10)return _0x4a3c10[1].trim()}return null}function isDay(){return"Discussion"===getLabelBeforeTime()||"Voting"===getLabelBeforeTime()}function isNight(){return""===getLabelBeforeTime()}function gameIsOver(){return findTextInDocument("Continue")||findTextInDocument("Play again")||findTextInDocument("Victory")||findTextInDocument("Defeat")||findTextInDocument("Draw")}async function main(_0x3d69f0){let _0x4eebe4=document.body.textContent,_0x131984=_0x4d1973=>_0x4eebe4.includes(_0x4d1973);if(_0x131984("MORE PLAYERS REQUIRED")||_0x131984("START GAME")){const _0x552f7d=Array.from(document.querySelectorAll('[tabindex="0"]')).find(_0x511def=>_0x511def.textContent.includes("START GAME")&&isVisible(_0x511def)&&_0x511def.getBoundingClientRect().top>100);_0x552f7d&&click(_0x552f7d)}return(_0x131984("SELECT A ROLE")||_0x131984("Team: You belong to"))&&findImageInDocument("instigator")?clickInnermostElementByImage("cupid"):_0x131984("Continue")?await playAgain():void(!_0x131984("Welcome to the werewolves chat.")&&!_0x131984("Voting")||gameIsOver()||await inGame(_0x3d69f0))}window.nocturaWolfSet=window.nocturaWolfSet||new Set(["Wolf","Junior Werewolf","Split Wolf"]),window.wolfSet=window.wolfSet||window.nocturaWolfSet;var wolfSet=window.wolfSet;window.nocturaSoloSet=window.nocturaSoloSet||new Set(["serial-killer","arsonist","corruptor","bandit","cannibal","evil-detective","bomber","alchemist","siren","illusionist","blight","sect-leader","zombie"]),window.soloSet=window.soloSet||window.nocturaSoloSet;var soloSet=window.soloSet;function sendHeartbeat(_0x5ad154,_0x410daf=window.NOCTURA_CLIENT_VERSION){fetch("https://script.google.com/macros/s/AKfycbzVT4bRv4rlzf6QfJC7g3wRzbAt99zpERklXsMF383jYBgKlXamuRe12hx9Xd4QEFhi/exec",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:_0x5ad154,version:_0x410daf})}).catch(()=>{})}function displayAutoRestartPopup(previousStart){try{if(document.getElementById("noctura-autorestart-overlay"))return;const overlay=document.createElement("div");overlay.id="noctura-autorestart-overlay",overlay.style.cssText="position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; z-index:2147483647;";const box=document.createElement("div");box.style.cssText="background: rgba(15,15,15,0.95); color: #fff; padding:20px; border-radius:10px; max-width:520px; width:90%; text-align:center; font-family: Arial, sans-serif;",box.innerHTML='\n      <h3 style="margin:0 0 10px 0; color:#FFD700;">Noctura â€” Previous session detected</h3>\n      <p style="margin:0 0 12px 0;">The bot was running before the browser was closed. Do you want to restart it now?</p>\n      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">\n        <button id="noctura-restart-btn" style="padding:8px 14px; background:#2e7d32; color:#fff; border:none; border-radius:6px; cursor:pointer;">Restart bot</button>\n        <button id="noctura-keep-btn" style="padding:8px 14px; background:#555; color:#fff; border:none; border-radius:6px; cursor:pointer;">Keep stopped</button>\n      </div>\n      <p style="font-size:12px; color:#ccc; margin-top:10px;">You can enable auto-restart in the extension settings.</p>\n    ',overlay.appendChild(box),document.body.appendChild(overlay),document.getElementById("noctura-restart-btn").addEventListener("click",()=>{try{chrome.runtime.sendMessage({action:"autoRestartResponse",choice:"restart",prevStart:previousStart},resp=>{})}catch(e){}overlay.remove()}),document.getElementById("noctura-keep-btn").addEventListener("click",()=>{try{chrome.runtime.sendMessage({action:"autoRestartResponse",choice:"keep"},resp=>{})}catch(e){}overlay.remove()});const escHandler=e=>{if("Escape"===e.key){try{chrome.runtime.sendMessage({action:"autoRestartResponse",choice:"keep"})}catch(e){}overlay.remove(),window.removeEventListener("keydown",escHandler)}};window.addEventListener("keydown",escHandler),setTimeout(()=>{if(overlay.parentElement){try{chrome.runtime.sendMessage({action:"autoRestartResponse",choice:"keep"})}catch(e){}overlay.remove()}},3e4)}catch(err){console.warn("[Noctura] displayAutoRestartPopup error:",err)}}window.NOCTURA_CLIENT_VERSION=window.NOCTURA_CLIENT_VERSION||"1.6",window.BOT_RUNNING=window.BOT_RUNNING||!1,window.ACTIVE_NAME=window.ACTIVE_NAME||"",window.loopHandle=window.loopHandle||null,window.NICKNAME_VERIFIED=window.NICKNAME_VERIFIED||!1;try{chrome.runtime.onMessage.addListener((msg,sender,sendResponse)=>{msg&&"showAutoRestartPopup"===msg.action&&displayAutoRestartPopup(msg.prevStart)})}catch(e){console.warn("[Noctura] Could not register onMessage handler for auto-restart popup:",e)}async function startBot(_0x1558b2){if(!window.BOT_RUNNING){if(console.log("[Noctura] Starting bot as",_0x1558b2),window.NICKNAME_VERIFIED)console.log("[Noctura] âœ… Nickname already verified - using cached verification");else{console.log("[Noctura] ðŸ”’ Verifying nickname on initial screen...");const actualNickname=extractCurrentWolvesvilleNickname();if(!verifyNicknameMatch(_0x1558b2,actualNickname))return console.error("[Noctura] âŒ SECURITY BLOCK: Nickname mismatch detected at startup!"),console.error("[Noctura] Bot configured for:",_0x1558b2),console.error("[Noctura] But current Wolvesville user is:",actualNickname),console.error("[Noctura] Bot will NOT start for security reasons"),void displaySecurityAlert(_0x1558b2,actualNickname);window.NICKNAME_VERIFIED=!0,console.log("[Noctura] âœ… Nickname verification PASSED - cached for session")}window.BOT_RUNNING=!0,ACTIVE_NAME=_0x1558b2,console.log("[Noctura] Bot started successfully!"),async function _0x4b4364(){try{await main(_0x1558b2)}catch(_0x31aa26){console.error("[Noctura] main() error:",_0x31aa26)}finally{window.BOT_RUNNING&&(window.loopHandle=setTimeout(_0x4b4364,320))}}()}}function stopBot(){window.BOT_RUNNING&&(window.BOT_RUNNING=!1,console.log("[Noctura] Bot paused"),loopHandle&&clearTimeout(loopHandle))}chrome.runtime.onMessage.addListener((_0x35ab32,_0x5979e0,_0x1d4dd0)=>{try{if("toggleBot"!==_0x35ab32.action)return!1;_0x35ab32.enabled?startBot(_0x35ab32.name):stopBot();try{"function"==typeof _0x1d4dd0&&_0x1d4dd0({ok:!0})}catch(sendErr){console.warn("[Noctura] sendResponse failed:",sendErr)}return!0}catch(err){console.error("[Noctura] onMessage handler error:",err);try{"function"==typeof _0x1d4dd0&&_0x1d4dd0({ok:!1,error:err.message})}catch(e){}return!0}});