!function(){const fpsDisplay=document.createElement("div");fpsDisplay.className="fps-display",fpsDisplay.style.position="absolute",fpsDisplay.style.top="5px",fpsDisplay.style.right="10px",fpsDisplay.style.color="var(--accent-color, gold)",fpsDisplay.style.fontSize="9px",fpsDisplay.style.fontFamily="monospace",fpsDisplay.style.zIndex="1000",fpsDisplay.style.opacity="0.8",fpsDisplay.style.display="block",document.body.appendChild(fpsDisplay);let lastTime=performance.now(),frameCount=0,fps=0,isRunning=!1,animationId=null;function loop(now){isRunning&&(frameCount++,now-lastTime>=1e3&&(fps=frameCount,frameCount=0,lastTime=now,fpsDisplay.textContent=`FPS: ${fps}`),animationId=requestAnimationFrame(loop))}window.startFPSMonitor=()=>{isRunning||(isRunning=!0,lastTime=performance.now(),frameCount=0,animationId=requestAnimationFrame(loop))},window.stopFPSMonitor=()=>{isRunning&&(isRunning=!1,animationId&&(cancelAnimationFrame(animationId),animationId=null),fpsDisplay.textContent="FPS: --")},fpsDisplay.textContent="FPS: --"}(),function(){const netDisplay=document.createElement("div");function update(){netDisplay.textContent=navigator.onLine?"WiFi: Online":"WiFi: Offline"}netDisplay.className="wifi-display",netDisplay.style.position="absolute",netDisplay.style.top="5px",netDisplay.style.left="10px",netDisplay.style.color="var(--accent-color, gold)",netDisplay.style.fontSize="9px",netDisplay.style.fontFamily="monospace",netDisplay.style.zIndex="1000",netDisplay.style.opacity="0.8",netDisplay.style.display="block",document.body.appendChild(netDisplay),window.addEventListener("online",update),window.addEventListener("offline",update),update()}(),chrome.runtime.onMessage.addListener((message,sender,sendResponse)=>{const fpsDisplay=document.querySelector(".fps-display"),wifiDisplay=document.querySelector(".wifi-display");"settingsOpened"===message.action&&(fpsDisplay&&(fpsDisplay.style.display="none"),wifiDisplay&&(wifiDisplay.style.display="none"))}),(()=>{const _0x369bd1="noctura_name",_0x2be12b="noctura_state",_0x36dbdf=_0x8e010e=>document.getElementById(_0x8e010e),_0xcc4cfd=_0x36dbdf("activeName"),_0x3f0a3e=_0x36dbdf("nameInput"),_0x1b970f=_0x36dbdf("editName"),_0x257890=_0x36dbdf("confirmName"),_0x5eb8b4=_0x36dbdf("licenseDot"),_0x57a9e8=_0x36dbdf("licenseText"),_0x1013cf=_0x36dbdf("licenseTime"),_0x441d83=_0x36dbdf("toggleBot"),_0x39ace4=_0x36dbdf("playIcon"),_0xaf5b4b=_0x36dbdf("timer"),_0x1ed588=_0x36dbdf("botStatusDot"),_0x5d15ed=_0x36dbdf("botStatusText");let _0x3eccbf=null,_0xcdf6ee=!1;function _0x1b90f8(_0x21a575){if(clearInterval(_0x3eccbf),!_0x21a575)return void(_0xaf5b4b.textContent="00:00:00");const updateTimerFromBackground=()=>{chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime.sendMessage({action:"getTimerState"},response=>{chrome.runtime.lastError?chrome.runtime.lastError.message.includes("Receiving end does not exist")&&(_0xaf5b4b.textContent="--:--:--"):response&&response.formatted?_0xaf5b4b.textContent=response.formatted:_0xaf5b4b.textContent="00:00:00"}):_0xaf5b4b.textContent="00:00:00"};updateTimerFromBackground(),_0x3eccbf=setInterval(updateTimerFromBackground,1e3)}function _0x896ba1(_0x592498){if(!_0x592498)return"expired";const expiryDate=new Date(_0x592498);if(isNaN(expiryDate.getTime()))return"invalid date";return`${expiryDate.getFullYear()}-${String(expiryDate.getMonth()+1).padStart(2,"0")}-${String(expiryDate.getDate()).padStart(2,"0")}`}async function _0x5930d6(_0x6c4240,force=!1){const now=Date.now(),CACHE_KEY="license_cache",cache=await new Promise(resolve=>chrome.storage.local.get("license_cache",r=>resolve(r.license_cache||null)));if(!force&&cache&&cache.name===_0x6c4240&&now-cache.timestamp<1728e5){if(console.log("Using cached license for",_0x6c4240),_0xcdf6ee=cache.valid,_0xcdf6ee){_0x5eb8b4.classList.add("valid");{_0x57a9e8.textContent="Valid (cached)";const _0x_formattedCacheExpires=cache&&cache.expires?_0x896ba1(cache.expires):"";_0x1013cf.textContent=_0x_formattedCacheExpires}_0x441d83.disabled=!1}else{_0x5eb8b4.classList.add("invalid"),_0x57a9e8.textContent="Blocked (cached)";const _0x_formattedCacheExpires2=cache&&cache.expires?_0x896ba1(cache.expires):"";_0x1013cf.textContent=_0x_formattedCacheExpires2,_0x441d83.disabled=!0}return _0xcdf6ee}_0x57a9e8.textContent="Checkingâ€¦",_0x5eb8b4.className="license-dot",_0x1013cf.textContent="",_0x441d83.disabled=!0;try{const url="https://script.google.com/macros/s/AKfycbzVT4bRv4rlzf6QfJC7g3wRzbAt99zpERklXsMF383jYBgKlXamuRe12hx9Xd4QEFhi/exec?user="+encodeURIComponent(_0x6c4240),res=await fetch(url,{method:"GET",cache:"no-cache",headers:{Accept:"application/json"}});if(!res.ok)throw new Error("License server error "+res.status);const data=await res.json();if(_0xcdf6ee=!1,data&&data.valid)if(data.role&&"admin"===data.role.toLowerCase())_0x5eb8b4.classList.add("valid"),_0x57a9e8.textContent="Valid (admin)",_0x1013cf.textContent="Never",_0x441d83.disabled=!1,_0xcdf6ee=!0;else{const expiresRaw=data.expires||"",expireLabel=_0x896ba1(expiresRaw||"1970-01-01T00:00:00.000Z");"expired"===expireLabel?(_0x5eb8b4.classList.add("invalid"),_0x57a9e8.textContent="Expired",_0x1013cf.textContent=expiresRaw||"",_0x441d83.disabled=!0,_0xcdf6ee=!1):(_0x5eb8b4.classList.add("valid"),_0x57a9e8.textContent="Valid",_0x1013cf.textContent="never expires"===expireLabel?"Never":expireLabel,_0x441d83.disabled=!1,_0xcdf6ee=!0)}else{_0x5eb8b4.classList.add("invalid"),data&&"expired"===data.reason?_0x57a9e8.textContent="Expired":data&&"not_found"===data.reason?_0x57a9e8.textContent="Not found":_0x57a9e8.textContent="Blocked";const _0x_formattedDataExpires=data&&data.expires?_0x896ba1(data.expires):"";_0x1013cf.textContent=_0x_formattedDataExpires,_0x441d83.disabled=!0,_0xcdf6ee=!1}await new Promise(resolve=>chrome.storage.local.set({[CACHE_KEY]:{name:_0x6c4240,valid:_0xcdf6ee,expires:data.expires||"",timestamp:now}},resolve))}catch(err){console.error("License check error:",err),_0x5eb8b4.classList.add("invalid"),_0x57a9e8.textContent="Error",_0x1013cf.textContent="Connection error",_0x441d83.disabled=!0,_0xcdf6ee=!1}return _0xcdf6ee}function _0x2ec5ff(_0x4d7446){_0x5d15ed.textContent=_0x4d7446?"Enabled":"Disabled",_0x1ed588.classList.toggle("running",_0x4d7446),_0x39ace4.textContent=_0x4d7446?"â¸":"â–¶"}chrome.storage.local.get(["noctura_name",_0x2be12b,"noctura_start"],async _0x1f2baa=>{const _0x51af52=_0x1f2baa.noctura_name||"",_0x5022ff=_0x1f2baa[_0x2be12b]||!1;_0x1f2baa.noctura_start;_0xcc4cfd.textContent=_0x51af52,await _0x5930d6(_0x51af52),_0x2ec5ff(_0x5022ff&&_0xcdf6ee),_0x1b90f8(_0x5022ff&&_0xcdf6ee)}),_0x1b970f.onclick=()=>{_0x3f0a3e.value=_0xcc4cfd.textContent,_0xcc4cfd.hidden=!0,_0x1b970f.hidden=!0,_0x3f0a3e.style.display="inline-block",_0x257890.style.display="inline-block",_0x3f0a3e.focus()},_0x257890.onclick=async()=>{const _0x3484a6=_0x3f0a3e.value.trim().slice(0,14)||"";chrome.storage.local.set({[_0x369bd1]:_0x3484a6}),_0xcc4cfd.textContent=_0x3484a6,_0x3f0a3e.style.display="none",_0x257890.style.display="none",_0xcc4cfd.hidden=!1,_0x1b970f.hidden=!1,await _0x5930d6(_0x3484a6,!0),sessionStorage.removeItem(`nickname_verified_${_0x3484a6}`),console.log("[Noctura Security] Nickname verification reset due to name change")},_0x3f0a3e.addEventListener("keydown",_0x36d709=>{"Enter"===_0x36d709.key&&_0x257890.click()}),window.addEventListener("unload",()=>{_0x3eccbf&&clearInterval(_0x3eccbf)}),_0x441d83.addEventListener("click",async()=>{const _0x5ba0ac=_0xcc4cfd.textContent;if(!await new Promise(resolve=>{chrome.storage.local.get([_0x2be12b],result=>{resolve(result[_0x2be12b]||!1)})})){if(console.log("[Noctura] ðŸš€ Bot starting - performing security checks"),!await _0x5930d6(_0x5ba0ac))return void alert("Name not allowed or license expired.");console.log("[Noctura Security] ðŸ”’ Starting nickname verification with Method 0 (header-based)...");const nicknameVerification=await async function(botConfiguredNickname){try{console.log("[Noctura Security] Verifying nickname match...");const[tab]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!tab||!tab.url.includes("wolvesville.com"))return{success:!0,reason:"not_on_wolvesville"};const cacheKey=`verified_nickname_${botConfiguredNickname}`;sessionStorage.removeItem(cacheKey);const results=await chrome.scripting.executeScript({target:{tabId:tab.id},func:()=>{function removeSymbolsFromNickname(nickname){if(!nickname)return nickname;let cleanName=nickname;return cleanName.includes("|")&&(cleanName=cleanName.split("|").pop().trim()),cleanName}return function(){try{const commonUIStringsLower=new Set(["Menu","Home","Play","Settings","Profile","Friends","Start","Stop","Continue","Back","Next","Previous","Yes","No","OK","Cancel","Login","Register","Loading","Game","Lobby","Chat","Vote","Day","Night","Voting","Werewolf","Villager","Role","Team","Dead","Alive","Join","Leave","Ready","Waiting","Players","Required","Store","Shop","Market","Collection","News","Updates","Inventory","Inbox","Notifications","Achievements","Quests","Wolvesville","Noctura","Season","Leaderboard","Ranked"].map(value=>value.toLowerCase())),isCommonUIString=candidate=>"string"==typeof candidate&&commonUIStringsLower.has(candidate.toLowerCase()),profileDivs=Array.from(document.querySelectorAll('div[class*="css-146c3p1"][class*="r-jwli3a"][class*="r-ubezar"]'));for(const div of profileDivs){const text=div.textContent?.trim();if(text&&!(text.length<2))if(text.includes("|")){const parts=text.split("|"),nickname=parts[parts.length-1].trim();if(nickname.length>=2&&nickname.length<=30)return removeSymbolsFromNickname(text)}else if(text.length>=2&&text.length<=30&&!text.match(/^\d+$/)&&text.match(/[a-zA-Z]/)&&!isCommonUIString(text))return text}const allTextElements=document.querySelectorAll("*");for(const element of allTextElements){const text=element.textContent?.trim();if(text&&text.includes("|")){const rect=element.getBoundingClientRect();if(!(rect.top<200&&rect.left>.5*window.innerWidth))continue;const parts=text.split("|");if(parts.length>=2){const potentialNick=parts[parts.length-1].trim();if(potentialNick&&potentialNick.length>=2&&potentialNick.length<=30&&/^[a-zA-Z0-9_.-]+$/.test(potentialNick)&&!isCommonUIString(potentialNick)){console.log("[Security Check] ðŸ” âœ… FOUND pipe-separated nickname:",text);const cleanNickname=removeSymbolsFromNickname(text);if(cleanNickname&&!isCommonUIString(cleanNickname))return cleanNickname}}}}console.log("[Security Check] ðŸ” Method 1B: Looking for simple nicknames in top-right only...");const topRightElements=Array.from(allTextElements).filter(el=>{const rect=el.getBoundingClientRect();return rect.top<200&&rect.left>.5*window.innerWidth});for(const element of topRightElements){const text=element.textContent?.trim();if(text&&!text.includes("|")&&text.length>=2&&text.length<=30&&/^[a-zA-Z0-9_-]+$/.test(text)&&!isCommonUIString(text)&&!text.match(/^\d+$/)&&text.match(/[a-zA-Z]/))return console.log("[Security Check] ðŸ” âœ… FOUND simple nickname in top-right:",text),text}console.log("[Security Check] ðŸ” Method 2: Enhanced fallback...");const potentialNicknames=[];for(const element of allTextElements){const text=element.textContent?.trim();if(!text)continue;const rect=element.getBoundingClientRect();let areaBonus=rect.top<200&&rect.left>.5*window.innerWidth?100:0,candidates=[text];text.includes("|")&&candidates.push(text.split("|").pop().trim());for(const candidate of candidates)if(candidate&&candidate.length>=2&&candidate.length<=30&&!candidate.includes(" ")&&/^[a-zA-Z0-9_.-]+$/.test(candidate)&&!isCommonUIString(candidate)&&!candidate.match(/^\d+$/)&&candidate.match(/[a-zA-Z]/)){const escapedCandidate=candidate.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),regex=new RegExp(`\\b${escapedCandidate}\\b`,"g"),matches=document.body?.textContent?.match(regex),count=matches?matches.length:0;if(count>=1&&count<=15){let contextScore=0;const allTextContent=document.body?.textContent?.toLowerCase()||"";(allTextContent.includes(candidate.toLowerCase()+" is")||allTextContent.includes("player "+candidate.toLowerCase())||allTextContent.includes(candidate.toLowerCase()+" voted")||allTextContent.includes("welcome "+candidate.toLowerCase()))&&(contextScore+=5),text.includes("|")&&text.includes(candidate)&&(contextScore+=3),potentialNicknames.push({text:candidate,originalText:text,count:count,contextScore:contextScore,totalScore:count+contextScore+areaBonus})}}}return potentialNicknames.length>0?(potentialNicknames.sort((a,b)=>b.totalScore-a.totalScore),console.log("[Security Check] ðŸ” Best candidate found:",potentialNicknames[0]),removeSymbolsFromNickname(potentialNicknames[0].originalText)):(console.warn("[Security Check] âš ï¸ No nickname found"),null)}catch(error){return console.error("[Security Check] âŒ Error:",error),null}}()}}),siteNickname=results[0]?.result;if(console.log(`[Noctura Security] Site nickname detected: "${siteNickname}"`),!siteNickname)return console.warn("[Noctura Security] Could not extract nickname from site"),{success:!1,reason:"extraction_failed",siteNickname:null,botNickname:botConfiguredNickname};function normalizeNickname(nick){return nick?nick.toLowerCase().replace(/[^a-z0-9]/gi,"").trim():""}const cleanBotNickname=normalizeNickname(botConfiguredNickname),cleanSiteNickname=normalizeNickname(siteNickname),isMatch=cleanBotNickname===cleanSiteNickname;return console.log("[Noctura Security] Nickname comparison:"),console.log(`[Noctura Security] - Bot configured: "${botConfiguredNickname}" â†’ "${cleanBotNickname}"`),console.log(`[Noctura Security] - Site current: "${siteNickname}" â†’ "${cleanSiteNickname}"`),console.log("[Noctura Security] - Match result: "+(isMatch?"âœ… OK":"âŒ FAIL")),{success:isMatch,reason:isMatch?"verified":"mismatch",siteNickname:siteNickname,botNickname:botConfiguredNickname,cleanBotNickname:cleanBotNickname,cleanSiteNickname:cleanSiteNickname}}catch(error){return console.error("[Noctura Security] Verification error:",error),{success:!1,reason:"error",error:error.message,siteNickname:null,botNickname:botConfiguredNickname}}}(_0x5ba0ac);if(!nicknameVerification.success)return console.error("[Noctura Security] âŒ NICKNAME MISMATCH DETECTED!"),console.error("[Noctura Security] Bot configured for:",_0x5ba0ac),console.error("[Noctura Security] Current Wolvesville user:",nicknameVerification.siteNickname),void alert(`âŒ SECURITY ERROR\n\nThe bot is configured for: "${_0x5ba0ac}"\n\nPlease make sure you meet these 3 requirements:\n1) Update your license or log in with the correct account.\n2) Make sure you are on the Wolvesville main page.\n3) Reload the game page and try again.\n\nIf the issue persists, open a support ticket on Noctura.`);console.log("[Noctura Security] âœ… Nickname verification passed!");const sessionKey=`verified_nickname_${_0x5ba0ac}`;sessionStorage.setItem(sessionKey,nicknameVerification.siteNickname);try{const[tab]=await chrome.tabs.query({active:!0,currentWindow:!0});tab&&tab.url.includes("wolvesville.com")&&await chrome.scripting.executeScript({target:{tabId:tab.id},func:()=>{void 0!==window.NICKNAME_VERIFIED&&(window.NICKNAME_VERIFIED=!0,console.log("[Noctura] âœ… Popup verification communicated to content script - no more verifications needed"))}})}catch(error){console.warn("[Noctura Security] Could not communicate verification status to content script:",error)}}else console.log("[Noctura] ðŸ›‘ Bot stopping - skipping all security checks");chrome.storage.local.get([_0x2be12b,"noctura_start"],_0x4fdd2a=>{const _0x16c8bb=!_0x4fdd2a[_0x2be12b],_0x56e954=Date.now(),_0x23a0e4={[_0x2be12b]:_0x16c8bb};_0x16c8bb?(_0x23a0e4.noctura_start=_0x56e954,console.log("[Noctura] ðŸš€ STARTING DEBUG MODE - attaching to browser"),chrome.runtime&&chrome.runtime.sendMessage&&chrome.runtime.sendMessage({action:"startTimer"},response=>{chrome.runtime.lastError&&console.warn("[Noctura] Error starting timer:",chrome.runtime.lastError.message)}),window.startFPSMonitor&&window.startFPSMonitor()):(console.log("[Noctura] ðŸ›‘ STOPPING DEBUG MODE - detaching from browser"),chrome.runtime&&chrome.runtime.sendMessage&&chrome.runtime.sendMessage({action:"stopDebugger"},response=>{chrome.runtime.lastError?console.warn("[Noctura] Error stopping debugger:",chrome.runtime.lastError.message):(console.log("[Noctura] Debugger detached successfully"),chrome.runtime.sendMessage({action:"stopTimer"},response=>{chrome.runtime.lastError&&console.warn("[Noctura] Error stopping timer:",chrome.runtime.lastError.message)}))}),window.stopFPSMonitor&&window.stopFPSMonitor()),chrome.storage.local.set(_0x23a0e4,()=>{_0x2ec5ff(_0x16c8bb),_0x1b90f8(_0x16c8bb),chrome.tabs.query({url:"*://*.wolvesville.com/*"},_0x59bc99=>{const _0x48eee0=_0x59bc99[0];if(_0x48eee0){if(_0x16c8bb){chrome.storage.local.set({wolf_tab_id:_0x48eee0.id});try{chrome.runtime.sendMessage({action:"startDebugger"},resp=>{chrome.runtime.lastError?console.warn("[Noctura] startDebugger message failed:",chrome.runtime.lastError.message):console.log("[Noctura] startDebugger requested",resp)})}catch(err){console.warn("[Noctura] startDebugger sendMessage error:",err)}}try{chrome.tabs.sendMessage(_0x48eee0.id,{action:"toggleBot",enabled:_0x16c8bb,name:_0x5ba0ac},function(response){if(chrome.runtime.lastError){"true"===localStorage.getItem("noctura_debug")&&console.debug("[Noctura Debug] Content script not ready:",chrome.runtime.lastError.message);try{chrome.runtime.sendMessage({action:"startDebugger"},()=>{setTimeout(()=>{try{chrome.tabs.sendMessage(_0x48eee0.id,{action:"toggleBot",enabled:_0x16c8bb,name:_0x5ba0ac},()=>{chrome.runtime.lastError})}catch(err){}},600)})}catch(err){}}else response&&"true"===localStorage.getItem("noctura_debug")&&console.debug("[Noctura Debug] Toggle response:",response)})}catch(err){console.warn("[Noctura] tabs.sendMessage threw:",err)}}})})})})})(),(()=>{const settingsBtn=document.getElementById("settingsBtn"),backSettingsBtn=document.getElementById("backSettings"),sliderContainer=document.getElementById("sliderContainer"),overlay=document.querySelector(".popup-overlay"),settingsPanelOverlay=document.querySelector(".settings-panel-overlay"),themeSelect=document.getElementById("themeSelect"),opacityMinus=document.getElementById("opacityMinus"),opacityPlus=document.getElementById("opacityPlus"),opacityValue=document.getElementById("opacityValue"),accentColorPicker=document.getElementById("accentColorPicker"),refreshBtn=document.getElementById("refreshBtn"),DEFAULT_VISUAL_SETTINGS_opacity=1,DEFAULT_VISUAL_SETTINGS_accentColor="#ffcc00",DEFAULT_VISUAL_SETTINGS_zoom=100;function applyCustomAccentColor(color){const secondaryColor=function(hex,percent=20){const num=parseInt(hex.replace("#",""),16);return"#"+(Math.max(0,(num>>16)-Math.round(255*percent/100))<<16|Math.max(0,(num>>8&255)-Math.round(255*percent/100))<<8|Math.max(0,(255&num)-Math.round(255*percent/100))).toString(16).padStart(6,"0")}(color,15),gradient=`linear-gradient(135deg, ${secondaryColor}, ${color})`;document.body.style.setProperty("--accent-color",color),document.body.style.setProperty("--accent-secondary",secondaryColor),document.body.style.setProperty("--gold-gradient",gradient)}function refreshPopupVisualSettings(){chrome.storage.local.get(["noctura_theme","noctura_opacity","noctura_accentColor","noctura_fpsEnabled","noctura_connectionEnabled","noctura_timerEnabled","noctura_zoom"],data=>{const theme=data.noctura_theme||"default",opacity=void 0!==data.noctura_opacity?data.noctura_opacity:1,accentColor=data.noctura_accentColor||"#ffcc00",fpsEnabled=!1!==data.noctura_fpsEnabled,connectionEnabled=!1!==data.noctura_connectionEnabled,timerEnabled=!1!==data.noctura_timerEnabled;document.body.classList.remove("theme-default","theme-green","theme-blue","theme-red","theme-pink","theme-white"),document.body.classList.add(`theme-${theme}`),themeSelect&&(themeSelect.value=theme),overlay.style.opacity=opacity,settingsPanelOverlay&&(settingsPanelOverlay.style.opacity=opacity),opacityValue.textContent=opacity.toFixed(1),accentColorPicker.value=accentColor,applyCustomAccentColor(accentColor);const zoomSlider=document.getElementById("zoomSlider"),zoomValue=document.getElementById("zoomValue"),zoomPreview=document.querySelector(".zoom-preview"),savedZoom=data.noctura_zoom||100;if(zoomSlider&&zoomValue){if(zoomSlider.value=savedZoom,zoomValue.textContent=savedZoom+"%",zoomPreview){const scale=savedZoom/100;zoomPreview.style.transform=`translate(-50%, -50%) scale(${scale})`}const popupWrapper=document.getElementById("popupWrapper");popupWrapper&&popupWrapper.classList.add("no-transition");const scale=savedZoom/100;document.documentElement.style.setProperty("--popup-scale",scale);try{document.body.style.zoom=String(scale)}catch(err){console.warn("[Noctura] body.zoom not supported:",err)}setTimeout(()=>{popupWrapper&&popupWrapper.classList.remove("no-transition")},100)}zoomSlider&&!zoomSlider.dataset.nocturaZoomListeners&&(zoomSlider.addEventListener("input",e=>{const value=parseInt(e.target.value);if(zoomValue&&(zoomValue.textContent=value+"%"),zoomPreview){const scale=value/100;zoomPreview.style.transform=`translate(-50%, -50%) scale(${scale})`}}),zoomSlider.addEventListener("change",e=>{const value=parseInt(e.target.value),popupWrapper=document.getElementById("popupWrapper");popupWrapper&&popupWrapper.classList.add("no-transition");const scale=value/100;document.documentElement.style.setProperty("--popup-scale",scale);try{document.body.style.zoom=String(scale)}catch(err){console.warn("[Noctura] body.zoom not supported:",err)}chrome.storage.local.set({noctura_zoom:value}),setTimeout(()=>{popupWrapper&&popupWrapper.classList.remove("no-transition")},50)}),zoomSlider.dataset.nocturaZoomListeners="true");const fpsToggleEl=document.getElementById("fpsToggle"),connectionToggleEl=document.getElementById("connectionToggle"),timerToggleEl=document.getElementById("timerToggle");fpsToggleEl&&(fpsToggleEl.checked=!!fpsEnabled),connectionToggleEl&&(connectionToggleEl.checked=!!connectionEnabled),timerToggleEl&&(timerToggleEl.checked=!!timerEnabled);const fpsDisplay=document.querySelector(".fps-display"),wifiDisplay=document.querySelector(".wifi-display"),timer=document.getElementById("timer");fpsDisplay&&(fpsDisplay.style.display=fpsEnabled?"block":"none"),wifiDisplay&&(wifiDisplay.style.display=connectionEnabled?"block":"none"),timer&&(timer.style.opacity=timerEnabled?"1":"0",timer.style.visibility=timerEnabled?"visible":"hidden",timer.style.height=timerEnabled?"auto":"0",timer.style.margin=timerEnabled?"8px 0":"0")})}refreshBtn&&refreshBtn.addEventListener("click",()=>{!function(){const values={noctura_opacity:DEFAULT_VISUAL_SETTINGS_opacity,noctura_accentColor:DEFAULT_VISUAL_SETTINGS_accentColor,noctura_zoom:DEFAULT_VISUAL_SETTINGS_zoom};chrome.storage.local.set(values,()=>{document.documentElement.style.setProperty("--popup-scale",DEFAULT_VISUAL_SETTINGS_zoom/100);try{document.body.style.zoom=String(DEFAULT_VISUAL_SETTINGS_zoom/100)}catch(err){}refreshPopupVisualSettings()})}()}),refreshPopupVisualSettings(),settingsBtn.addEventListener("click",()=>{const fps=document.querySelector(".fps-display"),wifi=document.querySelector(".wifi-display");console.log("FPS element:",fps),console.log("WiFi element:",wifi),fps&&fps.remove(),wifi&&wifi.remove(),sliderContainer.classList.add("settings-open")}),backSettingsBtn.addEventListener("click",()=>{sliderContainer.classList.remove("settings-open"),location.reload()}),themeSelect.addEventListener("change",e=>{const newTheme=e.target.value;document.body.classList.remove("theme-default","theme-green","theme-blue","theme-red","theme-pink","theme-white"),document.body.classList.add(`theme-${newTheme}`),chrome.storage.local.set({noctura_theme:newTheme})}),opacityMinus.addEventListener("click",()=>{let currentOpacity=parseFloat(opacityValue.textContent);currentOpacity>.1&&(currentOpacity=Math.max(.1,currentOpacity-.1),overlay.style.opacity=currentOpacity,settingsPanelOverlay&&(settingsPanelOverlay.style.opacity=currentOpacity),opacityValue.textContent=currentOpacity.toFixed(1),chrome.storage.local.set({noctura_opacity:currentOpacity}))}),opacityPlus.addEventListener("click",()=>{let currentOpacity=parseFloat(opacityValue.textContent);currentOpacity<1&&(currentOpacity=Math.min(1,currentOpacity+.1),overlay.style.opacity=currentOpacity,settingsPanelOverlay&&(settingsPanelOverlay.style.opacity=currentOpacity),opacityValue.textContent=currentOpacity.toFixed(1),chrome.storage.local.set({noctura_opacity:currentOpacity}))}),accentColorPicker.addEventListener("input",e=>{const newColor=e.target.value;applyCustomAccentColor(newColor),chrome.storage.local.set({noctura_accentColor:newColor})});const discordBtn=document.getElementById("discordBtn");discordBtn&&discordBtn.addEventListener("click",()=>{chrome.tabs.create({url:"https://discord.gg/b3JMDN6tCU"})});const fpsToggle=document.getElementById("fpsToggle");fpsToggle&&fpsToggle.addEventListener("change",e=>{const enabled=!!e.target.checked;chrome.storage.local.set({noctura_fpsEnabled:enabled},()=>{const fpsDisplay=document.querySelector(".fps-display");fpsDisplay&&(fpsDisplay.style.display=enabled?"block":"none");try{enabled&&window.startFPSMonitor&&window.startFPSMonitor(),!enabled&&window.stopFPSMonitor&&window.stopFPSMonitor()}catch(err){console.warn("[Noctura] FPS toggle handler error:",err)}})});const connectionToggle=document.getElementById("connectionToggle");connectionToggle&&connectionToggle.addEventListener("change",e=>{const enabled=!!e.target.checked;chrome.storage.local.set({noctura_connectionEnabled:enabled},()=>{const wifiDisplay=document.querySelector(".wifi-display");wifiDisplay&&(wifiDisplay.style.display=enabled?"block":"none")})});const timerToggle=document.getElementById("timerToggle");timerToggle&&timerToggle.addEventListener("change",async e=>{const enabled=!!e.target.checked;try{chrome.storage.local.get(["noctura_state","noctura_start"],res=>{const isRunning=!!res.noctura_state;res.noctura_start;chrome.storage.local.set({noctura_timerEnabled:enabled},()=>{const timerEl=document.getElementById("timer");if(timerEl&&(timerEl.style.opacity=enabled?"1":"0",timerEl.style.visibility=enabled?"visible":"hidden"),enabled&&isRunning)try{chrome.runtime.sendMessage({action:"startTimer"},resp=>{chrome.runtime.lastError?console.warn("[Noctura] startTimer request failed:",chrome.runtime.lastError.message):console.log("[Noctura] startTimer requested",resp)})}catch(err){console.warn("[Noctura] startTimer sendMessage error:",err)}if(!enabled)try{chrome.runtime.sendMessage({action:"stopTimer"},resp=>{chrome.runtime.lastError?console.warn("[Noctura] stopTimer request failed:",chrome.runtime.lastError.message):console.log("[Noctura] stopTimer requested",resp)})}catch(err){console.warn("[Noctura] stopTimer sendMessage error:",err)}})})}catch(err){console.error("[Noctura] Timer toggle failed:",err)}})})();